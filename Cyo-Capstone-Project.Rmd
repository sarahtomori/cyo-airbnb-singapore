---
title: "Cya-harvard-airbnb"
author: "Sarah Tomori"
date: "04/01/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#1. Introduction

This project is part of the Harvard course "Capstone", which is one of 9 required in order to obtain a professional certificate in Data Science. 

In this "Choose Your Own"-project, I have chosen to use the dataset from Kaggle.com, consisting of Airbnb data in Singapore. Airbnb has gained popularity all over the world and is among many travellers a preferred form of accomodation over hotels. Thus, the hotel industry faces a lot of competetion from these private house owners looking to rent out their homes to holiday visiters. 

A various number of things could contribute to determining, how much should be charged for a visitor to stay in an Airbnb. Thus, the purpose of the project is to try to predict, which factors (variable) that affect the price of an Airbnb in Singapore the most. 

##### Load all the packages required.

```{r}
library("readr", lib.loc="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
library("caret", lib.loc="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
library("magrittr", lib.loc="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
library("dplyr", lib.loc="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
library("wordcloud", lib.loc="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
library("SnowballC", lib.loc="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
```

##### Read the file with the singapore airbnb data.

```{r}
data <- read_csv("./data.csv")
```

##### Then you need to create the test set, which will be 10% of the whole data set. The test set will be kept till the very end and will ONLY be used to run the finally chosen algorithm on.

```{r}
# Create test set as 10% of the dataset
set.seed(1, sample.kind="Rounding")
test_index <- createDataPartition(y = data$price, times = 1, p = 0.1, list = FALSE)
airbnb_singapore <- data[-test_index,]
temp <- data[test_index,]
```

##### You need to make sure that the host id that is present in the test set is also present in training set.
```{r}
# Make sure that host_id in the test set are present in the airbnb_singapore set
test_set <- temp %>%
  semi_join(airbnb_singapore, by = "host_id")
# Add rows removed from test set back into airbnb_singapore set
removed <- anti_join(temp, test_set)
airbnb_singapore <- rbind(airbnb_singapore, removed)
rm(temp, data, removed)
```

##### A validation set is also created and this set is meant to test the intermediary models when training, before deciding on the best and final model.
```{r}
# Split airbnb_singapore data further in to validation and training sets
# Validation set will be 10% of current airbnb_singapore data
set.seed(1, sample.kind="Rounding")
# if using R 3.5 or earlier, use `set.seed(1)` instead
test_index2 <- createDataPartition(y = airbnb_singapore$price, times = 1, p = 0.1, list = FALSE)
train_set <- airbnb_singapore[-test_index2,]
temp2 <- airbnb_singapore[test_index2,]
```

##### As done with the creation of the test set, we need to make sure that host_id in the validation set is also in the training set.

```{r}
# Make sure host_id in validation is also in training set
validation <- temp2 %>% 
  semi_join(train_set, by = "host_id")
# Add rows removed from validation back into training set
removed <- anti_join(temp2, validation)
train_set <- rbind(train_set, removed)
rm(temp2, removed)
```

## 1.2 Exploring the data

##### The next step is to explore the data before analysing it. As the data is taken from Kaggle.com and is ready to use, not much data cleaning was necessesary to do beforehand.

```{r}
# Check class of data
class(airbnb_singapore)
```

##### We can see that our data is a data frame.

```{r}
# Get brief overview of the data
glimpse(airbnb_singapore)
```

##### From above, it is shown that there are 16 variables in the data set. id is used to identify the Airbnb listing and is unique for each listing. host_id is used to identify the host responsible for the respective listing - it is possible for a host to have more than one listing, if they rent out more than one Airbnb.
 
```{r}
# See a summary of the data
summary(airbnb_singapore)
```

##### Looking at this summary, we see that the minimum minimum price shown is 0 Singaporean dollars per night while the maximum shown is 10000 Singaporean dollars per night.

```{r}
# Check whether there are any missing values
anyNA(airbnb_singapore)
```

##### There are some missing values in the dataset. We might have to process that before starting the analysis.

```{r}
# Show unique values of airbnb prices
unique(airbnb_singapore$price)

#Show the number of unique values of prices
n_distinct(unique(airbnb_singapore$price))
```

##### There is a great range of various unique prices, which is due to the continuous nature of this variable. In fact, there are 364 different prices in the dataset.

##### Next, we can show how many hosts, listings, regions, neighbourhoods and types of rooms the dataset contains in total.

```{r}
# Show number of hosts, listings, regions, neighbourhoods and room types
airbnb_singapore %>% summarize(n_hosts = n_distinct(host_id), n_listings = n_distinct(id), n_regions = n_distinct(neighbourhood_group), n_neighbourhoods = n_distinct(neighbourhood), n_types = n_distinct(room_type))
```

##### This shows that there are 2705 hosts, 7305 listings, 5 regions, 43 neighbourhoods and 3 types of rooms possible to rent. The fact that the number of hosts is less than half the number of listings, confirms the earlier statement claiming that some hosts will likely be hosts for more than one listing.

##### Next, we will look at the minimum nights required in order to stay in an Airbnb in Singapore.
```{r}
# Show average minimum nights required
mean(airbnb_singapore$minimum_nights)
```

##### The average minimum number of nights required to stay at an Airbnb is 17.59 nights. This indicates that many owners require you to stay for a longer period of time in order to rent out their accommodation. However, it could also be an indication that there are many listings available on the Singaporean Airbnb platform with the purpose of long duration rental.

##### We can also show what the average price level is per night in Singapore.
```{r}
# Show average price per night
mean(airbnb_singapore$price)
```

##### The average price is 168 Singaporean dollars.

# Visualisation of the data 

##### It is necessary to review how our data looks before we proceed to the analysing stage of the project. 

##### First, a histogram is created to show the distribution of prices among the various listings.
```{r}
# Price distributions in the training set
airbnb_singapore %>% ggplot(aes(price)) + geom_histogram(color = "#000000", fill = "#FFCCCC") +
ggtitle("Distribution of prices across Airbnbs")
```

##### From the histogram above, we see that majority of the Airbnb listings are in the cheaper end of the scale. The further to the right one looks, the fewer Airbnbs are typically to find at that price level. It also shows that there are many various price levels once the Airbnb costs less than 25 Singaporean dollars per night.

##### Due to the continuous nature of the prices and the large variation in prices, it is a bit hard to interpret the above histogram. Instead, we can also see the top 20 most common prices

```{r}
most_common_prices <- airbnb_singapore %>% group_by(price) %>% summarize(count = n()) %>% top_n(20, count) %>% arrange(desc(count))
most_common_prices
```

##### It is found that 50 Singaporean dollars is the most common price with 203 priced at this level. Secondly, 60 Singaporean dollars is commonly used to price Airbnbs as well.

##### A display of the availability distribution can be shown as well.

```{r}
#Check distributions of availability in the training set
airbnb_singapore %>% ggplot(aes(availability_365)) + geom_histogram(bins = 20, fill = "#009999") +
ggtitle("Availability")
```

##### The graph shows that while some are only available less than 300 days a year, the far majority of Airbnbs are actually available for rent all 365 days or at least close to all.

##### The distribution below shows the number of listings in each regions. Each listing have a unique id, thus, by counting the id variable, we assume this will give us the total number of listings, as an Airbnb should only be listed on the website once.

```{r}
#Check distributions of listings in the various regions in training set
airbnb_singapore %>% group_by(neighbourhood_group) %>% ggplot(aes(n)) + geom_histogram(bins = 20, fill = "#009999") +
ggtitle("Number of listings in regions")
```

##### Show the neighbourhoods with the most listings.
```{r}

#First, save the number of listings in each neighbourhood.

top_neighbourhoods <- airbnb_singapore %>% group_by(neighbourhood) %>% summarize(count = n()) %>% top_n(20, count) %>% arrange(desc(count))
top_neighbourhoods

#We can also show them in a bar chart.

top_neighbourhoods %>% ggplot(aes(reorder(neighbourhood, count), count, fill = count)) +
geom_bar(stat = "identity") + coord_flip() +
scale_fill_distiller(palette = "Reds") + labs(y = "Number", x = "Neighbourhood") +
ggtitle("Popular neighbourhoods")

```

